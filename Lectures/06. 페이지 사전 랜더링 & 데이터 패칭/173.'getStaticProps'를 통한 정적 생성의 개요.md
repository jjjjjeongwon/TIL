이제 Next.js를 이용한 데이터 페칭 첫 번째 사전 렌더링 양식을 살펴보죠

바로 정적 생성인데, 일반적으로 권장되는 방법이라고 말했었죠

본 섹션에서 처음부터 상세히 살펴볼 거예요

정적 생성의 개념은 간단합니다

빌드하는 동안 페이지를 사전 생성하는 거죠

사전 생성이라 함은 콘텐츠를 구성하는 모든 HTML 코드와

모든 데이터를 사전에 준비시켜 놓는다는 뜻입니다

서버 사이드에서 보면 헷갈릴 수 있습니다

즉 보통 서버 사이드에서만 실행되는 코드를

빌드 프로세스 동안 실행되도록 허용하는 거죠

파일 시스템과 상호작용하는 코드를 예시로 들 수 있겠네요

금방 실제로 다뤄볼 건데요

빌드 시간 중 데이터와 페이지가 준비되는데

이때 빌드 시간은 배포 전 애플리케이션을 구축할 때를 말합니다

빌드 시간 중 페이지가 사전에 구축되었기 때문에

배포되고 나면 구축된 페이지는 서버나 앱을 실행시키는

CDN을 통해서 캐시로 저장됩니다

이에 사전 구축된 페이지를 통해서 즉시 입력 요청이 실행될 수 있죠

앞서 설명한 대로 해당 페이지가 표시되고 난 뒤에도

여러분의 React 앱을 통해 수화(hydrate) 작업을 거칩니다

결국에는 표준 React 앱이 되는 거죠

여러분의 클라이언트에게 전송되는 페이지와의 차이점이라고 하면

빈 페이지가 아니라 사전에 콘텐츠로 채워져 있다는 점입니다

여전히 원하는 작업은 수행할 수 있으므로 일반 React 앱인 셈이죠

이때 중요한 문제라고 하면

Next.js에 어떤 페이지를 사전에 생성해야 하는지 지정하는 일입니다

사전 생성할 페이지에 어떤 데이터가 포함되어야 하는지는 어떻게 지정할까요?

이에 대한 해답은 페이지 컴포넌트에서

가져올 수 있는 특정 함수에서 찾을 수 있습니다

이는 반드시 사용하는 페이지 컴포넌트의 내부에 있어야 하며

다른 React 컴포넌트가 아닌

pages 폴더의 component 파일 내부가 그 위치여야 합니다

그 안에서 특수한 비동기 함수인 getStaticProps를 가져오는데

이때 그 이름이 정확히 getStaticProps여야 합니다

Next.js에서 이 이름 그대로 함수를 찾기 때문이죠

이는 프로미스를 반환하는 비동기 함수로 그 안에 await 키워드를 쓸 수 있습니다

그리고 이 함수에서 주목할 점은

보통 서버 사이드에서만 실행되는 모든 코드도 실행할 수가 있다는 겁니다

이 함수에서는 클라이언트 사이드 코드로만 제한되는 게 아니라

특정 클라이언트 사이드 API에 액세스가 없거나

윈도우 객체에 대한 액세스가 없는

일반적으로는 서버 사이드에서만

가능한 모든 코드도 실행할 수 있는 거죠

더 나아가서 getStaticProps 내에 작성한 코드는

클라이언트에게 재전송되는 코드로 포함되지 않는다는 겁니다

즉, 해당 함수 내에 포함하는 코드는 클라이언트는 볼 수 없죠

가령 데이터베이스 크리덴셜(credential)을 포함하고 있는 경우에는

이를 클라이언트 사이드에 노출하고 싶지 않을 테니

getStaticProps 내에 해당 코드를 작성하여

클라이언트 사이드에서 볼 수 없게 할 수 있습니다

그럼 이제 이 함수에 대해 더욱 자세히 알아보고, 코드를 직접

작성해 보며 그 원리를 완벽히 이해해 보도록 하겠습니다
