더미 코드와 함께 getStaticProps를 추가했습니다

그러나 현재로서는 그 함수를

추가해야 하는 어떤 것도 하지 않았습니다

컴포넌트 함수에서도 이와 같은 더미 데이터를 준비할 수 있습니다

물론 getStaticProps를 시작하기 위해 간단한 예제로 시작했는데

보다 현실적인 예는 데이터를 로드하려는

이 dummy-backend.json 파일 같은 데이터 파일이 있는 겁니다

하지만 페이지가 준비될 때 데이터를 로드해야 합니다

클라이언트 사이드에서 HTTP 요청이나 비슷한 걸 통해

해당 파일에 접근하면 안 됩니다

이제 getStaticProps 내부의 모든 코드가

서버 사이드에서 서버 사이드 기능과 함께

실행된다는 점을 활용할 겁니다

예를 들어 파일 시스템으로 작업할 수 있다는 의미입니다

이를 위해 가장 위에 import fs from 'fs'를 추가합니다

이 코드는 Node.js로부터 파일 시스템 모듈을 임포트합니다

이 패키지는 설치가 필요한 서드 파티 패키지가 아니고

Node.js의 핵심 모듈입니다

브라우저 측 JavaScript가 파일 시스템에 접근할 수 없기 때문에

클라이언트 사이드에서는 fs 모듈 작업이 안됩니다

특히 여기 저희 프로젝트 파일 시스템은

방문자에게 제공되지 않아서 접근하지 못합니다

어쨌든 여기에서 임포트할 수 있고

getStaticProps에서 파일 시스템 모듈을 쓸 수 있습니다

그래서 여기서 fs를 사용할 수 있습니다 그리고 Next.js는 매우 똑똑해서

getStaticProps나 나중에 배우는 함수에서만 쓰이는

임포트를 확인하고

클라이언트 사이드 코드 번들에서는

이 임포트를 제거합니다

따라서 클라이언트 사이드 코드 브라우저 측 React 앱 코드가

준비될 때 그 임포트는 사라집니다

Next.js가 클라이언트 사이드에서 사용하지 않음을 알고 코드를 나누는 거죠

따라서 일반적으로 컴포넌트 코드는 클라이언트 사이드 코드에

포함되고 이 임포트와 이 코드는 포함되지 않습니다

이제 fs로 이 dummy-backend.json 파일에 액세스할 수 있습니다

fs.readFile이나 readFileSync 함수를 써서요

readFileSync는 파일을 동기적으로 읽고 완료될 때까지 실행을 차단합니다

반면에 readFile은 계속하려면 콜백해야 합니다

프로미스를 사용하는 Node.js 모듈의

특수 버전인 fs/promises에서 파일 시스템을 가져올 수도 있습니다

그러면 readFile은 프로미스를 반환합니다

그리고 이 함수는 비동기 함수이기 때문에 await을 앞에 붙여줍니다

이제 readFile은 읽어 오려고 하는 파일의 경로만 있으면 됩니다

여기에서 path를 구성할 수 있습니다 이름을 filePath로 지정하겠습니다

이 경로는 dummy-backend.json 파일로 연결되어야 합니다

이 경로를 구성하기 위해 Node.js에서

다른 모듈을 가져올 건데 path에서 path 모듈을 가져옵니다

이 모듈은 경로를 구축하는 데 유용한 기능이 있는 모듈입니다

여기에서 path를 쓰고 join 메서드를 실행해서

readFile이 사용할 수 있는 경로를 구축할 수 있습니다

여기서 현재 디렉토리 내부에서 시작해서

dummy-backend.json 파일이 있는 이 data 디렉토리로 이동해야 합니다

그래서 data 폴더로 가서

이 dummy-backend.json 파일을 가져와야 합니다

이를 위해 먼저 path.join에 어디서 시작하는지를 알려주고

다른 Node.js 객체로

현재 작업 디렉토리로 이동할 수 있습니다

그 객체는 Node.js에서 전역적으로 사용할 수 있는 process 객체입니다

그리고 process에 cwd 메서드를 실행할 수 있습니다

cwd는 현재 작업 디렉토리라는 뜻입니다

그리고 이는 실행될 때 이 코드 파일의 현재 작업 디렉토리를 제공합니다

여기서 중요한 것은 현재 작업 디렉토리가 pages 폴더가 아니라는 겁니다

대신 이 파일이 실행될 때 Next.js가 이를 실행하고

모든 파일이 루트 프로젝트 폴더에 있는 것처럼 취급합니다

따라서 현재 작업 디렉토리는 pages 폴더가 아닌

전체 프로젝트 폴더가 됩니다 이걸 아는 게 중요합니다

따라서 cwd로 Node.js path.join 메서드에

이 전체 프로젝트 디렉토리에서 시작한다고 알려주고 쉼표를 추가합니다

다음 인수는 data 폴더로 가야하기 때문에 'data'입니다

현재 작업 디렉토리 즉 프로젝트 디렉토리에서

시작해서 data 디렉토리로 가는 경로를 구축해야 합니다

그리고 또 다른 인수를 추가합니다 인수는 무한으로 추가할 수 있고

사용하려는 파일 이름을 넣어야 하므로 이 경우 dummy-backend.json입니다

이것은 이 파일에 대한 절대 경로를 구축하고

이 경로가 readFile에 전달되는 경로로, 이제 파일을 읽을 겁니다

이제 그 JSON 파일에서 jsonData를 가져오고

실제 데이터(data)를 가져오기 위해 JSON.parse(jsonD)를 입력합니다

JSON은 전역적으로 사용 가능한 객체고 브라우저 측에서와 마찬가지로

Node.js에서도 쓸 수 있습니다 이것은 jsonData를 파싱하고

일반 JavaScript 객체로 변환합니다

이제 data는 배열을 포함하는 products 키가 있는 객체가 됩니다

이제 이 data를 기반으로 하는 props를 반환할 수 있습니다

props에 포함된 products는 data.products가 됩니다

따라서 이 파일에서 페치한 products는

이제 이 객체의 products에 값으로 전달되므로

궁극적으로 Next.js가 이 함수를 실행할 때

이 컴포넌트 함수에 props를 통해 전달됩니다

하지만 먼저 이 함수를 거치게 됩니다

이제 모든 것을 저장하고 localhost:3000을 새로 고침하면

여기에 세 개의 Product가 표시됩니다 페이지 소스로 돌아가 보면

처음부터 모든 데이터가 있다는 것을 알 수 있습니다, 여기 있죠

사전 렌더링된 거죠, 클라이언트에 도달하지 않는 서버 사이드 코드를 실행하는

getStaticProps의 도움으로 사전 렌더링 되었습니다
