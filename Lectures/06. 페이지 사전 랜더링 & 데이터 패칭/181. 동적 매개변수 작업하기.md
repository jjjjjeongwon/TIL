# 지금 프로젝트에는 페이지가 하나만 있음

( index.js 페이지 )

## 📌 단순한 더미 상품 데이터가 있는데 데이터가 더 복잡해지면 어떻게 될까?

- 모든 상품에는 설명이 있다고 가정하면, (설명은 '상품 1입니다' 이렇게 JSON 키를 하나 추가. 두 번째는 '상품 2입니다' 세 번째 상품 설명은 '상품 3입니다'를 추가)
  index.js 파일에서 상품 목록을 렌더링하는데 모든 상품은 클릭 가능한 링크라서 상세 페이지로 이동할 수 있음. 즉, 전에 우리가 이벤트로 구축한 프로젝트처럼 상품에 대한 상세 페이지가 있음
- 그렇게 하려면 **새로운 페이지를 추가하고 거기에 대괄호가 있는 동적 세그먼트**를 만들면 됨. 이름은 [pid]로 함(식별자명은 원하시는 대로 해도 됨 .js를 붙이면 동적 페이지)
- 여기에 컴포넌트 함수인 `ProductDetailPage()`를 추가 바로 이 페이지의 컴포넌트에서 상품 세부 사항을 보여줄 것

```jsx
function ProductDetailPage(props) {
  const { loadedProduct } = props;

  return (
    <Fragment>
      <h1>TITLE</h1>
      <p>DESCRIPTION</p>
    </Fragment>
  );
}
```

→ 이 데이터는 dummy-backend.json 파일에서도 역시 페칭되어야 함

# 💡 방식 ?

### _1. 물론 여기에 표준 React 코드를 작성해도 됨_

- React에서 임포트한 useEffect를 사용해서 이 상품 데이터를 제공할 서버에 HTTP 요청을 보낼 수 있음
- 하지만 **페이지가 처음 렌더링 되어 데이터가 없다고 생각하면 검색 엔진이 볼 수 없음**!

### _2. 대신 여기에서 `async 프로퍼티 함수`를 다시 사용_

- export async function `getStaticProps()` 이 함수를 사용할 수 있음
- 다시 dummy-backend.json 파일에 접근하고 싶지만 지금은 파일 전체를 읽고 모든 상품을 반환하기보다 파일을 읽고 거기서 하나의 상품만 반환하려고 함
  → 그게 차이점!

### 어떤 상품이 여기에 반환될지 알아야 함

- 그리고 그 상품을 결정하기 위해서 URL에 있는 구체적인 값을 살펴보아야 함 (즉, pid 키에 대한 구체적인 값)
- 이때 콘텍스트(context) 매개변수가 다시 중요해짐. 앞서 잠시 언급했지만 NextJS에 의한 콘텍스트 매개변수를 사용하여 구체적인 매개변수 값을 구할 수 있기 때문
- 즉 경로상의 동적 세그먼트에 대한 구체적인 값을 알 수 있음. 그 값에 액세스하기 위해 context의 params 키를 봄 (NextJS가 제공하는 context 객체의 프로퍼티 중 하나)
- 그리고 params(매개변수)는 키-값 쌍이 있는 객체이며 이때 키의 식별자는 동적 경로 세그먼트(이 경우에는 [pid]가 됨. 페이지의 유일한 동적 매개변수, 또한 그 값은 URL에 입력된 구체적인 값이라고 할 수 있음)
- 이제 productId를 얻으려면 params.pid에 액세스(pid는 파일의 이름에서 가져옴)

## 📌 컴포넌트 함수와 `getStaticProps()`에서 매개변수를 추출할 때 차이점이 있음

**컴포넌트 함수에서 매개변수 추출**

- 컴포넌트 함수에서 매개변수를 추출하면 **컴포넌트 내부에서 사용 가능**
- 추출된 ID를 사용하거나 일부 백엔드 서버에 요청을 보내 거기에서 페칭하기 위해서,하지만 **이 과정은 브라우저에서만 이루어짐**

**getStaticProps()에서 매개변수 추출**

- `getStaticProps()`로 데이터를 준비하여 페이지를 사전 렌더링하게 되면 이 경우는 서버에서 이루어짐
- 그리고 `getStaticProps`는 컴포넌트 함수보다 먼저 실행됨. 그 이유는 컴포넌트 함수가 페이지를 사전 렌더링하기 위해 실행되는 함수이기 때문
- 그러므로 서버상에서 혹은 `getStaticProps`로 구축 과정 중에 페이지를 미리 준비하려면 매개변수로의 액세스가 필요
- 즉 `getStaticProps` 내부의 동적 경로 세그먼트에 액세스해서 매개변수 데이터를 통해 컴포넌트에 대한 데이터를 준비. 그러면 컴포넌트 함수 안에도 동적 세그먼트가 필요한 게 아니면 추출할 필요가 없기 때문

→ 그러나 데이터 사전 준비는 `getStaticProps`에서 해야 하며 dummy-backend.json 파일에 접근해서 해당하는 ID로 상품을 읽어야 함

## 이제 이 파일이 만들어졌으니 이 ID를 가진 상품에 대한 product를 필터링할 것

- product를 얻기 위해 `data.products`에 접근하고 `find()`를 호출한 다음 해당 배열의 모든 product에서 실행되는 함수를 전달하면 됨
- 배열에서 우리가 현재 보고 있는 상품의 ID가 위의 매개변수에서 얻은 productId와 동일할 경우 true를 반환. 그리고 동일하다면, 바로 그게 이 컴포넌트에 대한 상품임
- 이제 `getStaticProps`의 끝에 props 키가 있는 객체를 반환
- 이때 로딩된 상품인 `loadedProduct`는 페칭된 product와 동일하다고 설정. 그러면 `ProductDetailPage()`에서 `loadedProduct`를 사용할 수 있음
- 다시 객체 구조 분해로 `loadedProduct`를 추출하는데 props에서 얻을 수 있으므로 여기도 props를 허용
- 그리고 상품 이름을 읽을 수 있는 `loadedProduct.title` 또한 상품 설명 역시 `loadProduct.description`임

## 테스트를 위해 상세 페이지로 이동할 수 있는지 보자!

- index.js 파일에서 li(리스트 아이템)의 텍스트를 Link 컴포넌트로 감싸주고 product.title을 <Link> 태그 사이에 넣음
- href는 템플릿 리터럴로 구성된 동적 값이 됨. 즉 슬래시(/) 다음에 product.id를 넣어주면 됨

## 이제 저장하면 클릭 가능한 링크가 나타나는데 링크를 클릭했더니 **에러가 생기고 getStaticPaths가 필요하다고 함**

→ 예상했던 에러로 중요한 부분!

→ 어떤 에러인지 다음 강의에서 함께 살펴보기 전에 **여기 있는 코드 대부분이 올바르**다는 점을 기억하자!

→ URL에 인코딩된 구체적인 값에 액세스하려고 params를 사용했으며 그렇게 추출된 데이터를 사용하여 특정한 데이터를 페칭하고 컴포넌트에 활용함

### 그러니 잘못된 코딩은 아닌데 오류가 발생하는 것! 왜 이런 오류가 있는지 확인해보자!!!
