getStaticProps 함수는 모든 페이지 파일에 추가할 수 있고

페이지에만 추가할 수 있으며 내보내야(export) 합니다

그렇게 하면 Next.js가 페이지를 사전 생성할 때 사용자를 대신하여

이 getStaticProps 함수도 호출합니다

이 함수는 이 페이지가 사전 생성되어야 하는 페이지임을

Next.js에 알려줍니다

Next.js는 기본값으로 모든 페이지를 사전 렌더링하지만

이후에 Next.js가 페이지를 사전에 렌더링하지 않게 하는 방법을 배웁니다

따라서 getStaticProps가

Next.js에 사전 렌더링하지 말라고 지시하지 않고

Next.js가 이 페이지를 여전히 사전 생성되어야 하도록 한다는 것을

이해하는 것이 중요합니다

Next.js는 컴포넌트를 실행하고 JSX 코드를 반환하는 것 외에도

컴포넌트 파일에서 getStaticProps 함수를 찾으면

그 함수도 호출합니다

여기에서 이 Product 데이터를 동적으로 로드할 건데

이전에 표준 React 앱에서 수행하는 방식으로 보여드린

useEffect를 사용하지 않고 로드해 보겠습니다

그래서 첨부된 파일을 보면

dummy-backend.json 파일이 보이실 겁니다 이 더미 파일은

아까 전 React 예시를 보여드릴 때 썼던 파일인데

이 파일은 public이나 pages 폴더가 아닌

여러분의 주요 프로젝트 폴더에 추가하셔야 합니다

아니면 data 폴더를 추가해도 됩니다 앗, 폴더가 아닌 파일을 만들었네요

data 폴더를 추가하고 이 파일을 그 폴더에 옮겨주세요 data 폴더에

dummy-backend.json 파일이 넣어도 되는 거죠

이제 index.js 파일에 넣기 위해 방금 파일에서 데이터를 로드하는데

페이지가 로드된 후에만 클라이언트 사이드에서 전송되는

HTTP 요청 대신

이 컴포넌트를 생성하기 전에 그리고 Next.js가

이 컴포넌트 페이지를 사전 렌더링하기 전 데이터를 프리페치해야 합니다

그래서 export async function getStaticProps()으로

getStaticProps라는 함수를 추가하는 겁니다

정확히 이렇게 호출해야 합니다

이 함수에서는 항상 객체를 반환해야 합니다

함수 이름이 getStaticProps라서 props 키가 있는 객체를 반환해야 하고

이 함수가 하는 일은 컴포넌트에 대한 프로퍼티를 준비하는 겁니다

즉 이 props 객체를 준비하는 거죠

파일에 getStaticProps 함수가 있으면 Next.js에서

먼저 이 함수를 실행하고

두 번째로 컴포넌트 함수를 실행합니다

첫 번째 단계에선 컴포넌트 함수에 대한 props를 준비하기 때문이죠

따라서 getStaticProps 함수에서는 원하는 코드를 제한 없이 실행 가능하고

클라이언트 사이드에서는 절대 볼 수 없는 코드로 데이터를 페칭하고

이 HomePage 컴포넌트에 props를 통해 데이터를 줄 수 있죠

그래서 여기서 props를 객체와 동일하게 설정해서

컴포넌트가 받는 props가 product 부분에서도 객체가 됩니다

그 객체는 가령 id: 'p1'이고

title: 'Product 1'인

이런 식의 배열이 될 수 있습니다

getStaticProps는 props 키를 포함한 객체를 반환해야 하고, 이는 필수 사항입니다

항상 프로퍼티 키가 있는 객체를 반환해야는 건 꼭 기억하세요

props 키의 데이터는 여러분이 설정하지만 객체여야 합니다

지금 여기 객체는 배열을 보유하는 products 키가 있는 객체이고

배열은 Product 객체의 배열이죠

그리고 Next.js가 먼저 이 getStaticProps 함수를 호출하면

이 컴포넌트 함수를 실행하기 때문에

이 HomePage의 props에서 이를 수신합니다

그리고 사전에 두 가지 작업을 모두 수행하기 때문에

클라이언트 사이드에서는 이 코드 모두 실행되지 않습니다

이 모든 것은 빌드되는 시간 동안이나

사용 중인 이 개발 서버의 일부로 개발 중에 발생합니다

그래서 HomePage 컴포넌트에서

props에 대한 products 키를 얻을 수 있고

객체 구조 분해를 통해 props에서 products를 가져올 수 있습니다

여기서 products를 쓴 이유는 이 아래에서 쓴 키이기 때문이죠

products에 접근하여 모든 products를

리스트 아이템으로 매핑하여 리스트를 동적으로 렌더링할 수 있습니다

키는 아래에서 가져온 id로 된 product.id입니다

그리고 리스트 아이템의 여는 태그와 닫는 태그 사이에 product.title을 넣어줍니다

이제 Next.js 애플리케이션에 가보면

Product 1이 보입니다

물론 지금은 파일에서 데이터를 페칭하는 게 아닙니다

하드 코딩하긴 했지만 이미 getStaticProps를 구현한 거죠

이 페이지의 페이지 소스를 보면 이 데이터

이 Product 1의 데이터는 클라이언트에게 보내진 페이지의 일부입니다

즉 Product 데이터 페칭은 클라이언트에서 발생하지 않았습니다

서버에서 발생한 거죠

그리고 개발자 도구의 Sources 탭으로 가서

JavaScript 코드 파일을 보면

이 코드는 아무 곳에서도 보이지 않을 겁니다

클라이언트 사이드에 제공되는 코드가 아니기 때문입니다

이는 getStaticProps의 코드가 클라이언트 사이드에서 실행되지 않기 때문에

서버 측 작업을 수행할 수 있음을 의미합니다

따라서 사용자가 볼 수 없는 크리덴셜(credential)을 쓸 수 있고

예를 들어 파일 시스템에 접근하는 코드와 같이 브라우저에서 작동하지 않는

코드를 실행할 수도 있습니다

바로 이어서 해보겠습니다
