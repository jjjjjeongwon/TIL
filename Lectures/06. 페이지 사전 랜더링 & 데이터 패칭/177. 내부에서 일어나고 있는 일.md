지금까지 사전 렌더링과 Next.js가 이를 어떻게 수행하는지에 대해

많이 설명했지만 개발 모드에서 웹사이트를

실행하는 것 외에는 본 적이 없죠

하지만 애플리케이션을 빌드할 때

Next.js가 정확히 무엇을 하는지 보여드리려고 합니다

이전에 build 스크립트를 언급한 적이 있었는데요

이 build 스크립트는 다음 애플리케이션

다음 Next.js 프로젝트를 배포할 때 실행하는 스크립트입니다

그리고 여기의 build 단계

가장 마지막에 실행될 이 "next build" 명령어가

페이지를 사전 생성합니다

그리고 이를 보여드리기 위해 개발 서버를 종료하고

npm run build를 실행하겠습니다

이 build 스크립트를 실행하고 이 프로젝트 폴더에서 "next build"를 실행합니다

'프로덕션용 최적화 빌드를 생성 중' 메시지가 뜨고

시간이 좀 걸리는데

조금 기다리면 빌드 프로세스가 끝납니다

여기에서 몇 가지 정보를 얻을 수 있습니다

오류가 없으니 빌드가 성공적인 거고

정적 페이지 두 개를 생성했음을 알 수 있습니다

아래에서 상세 결과를 볼 수 있는데요

하단의 범례를 보시면

●이 정적 측면 생성을 의미한다는 것을 알 수 있습니다

즉 getStaticProps를 사용하기 때문에

개발 또는 빌드 프로세스 중에 사전 생성된 페이지인 거죠

λ는 나중에 보게 될 서버 사이드 전용 페이지를 나타내고

○은 정적 즉 모든 페이지가 사전 생성되지만

데이터가 필요하지 않으므로 getStaticProps나

이와 유사한 것을 쓰지 않는 페이지입니다

다시 위로 스크롤하면

사전 생성된 두 페이지가 시작 페이지이므로 / 뒤에 아무것도 없는

index.js가 있고 404 페이지가 있습니다

추가하지는 않았지만 자동으로 생긴 거죠

이 /\_app 부분은 무시하셔도 됩니다

404 페이지에는 ○ 부분에 있는데 이는 아무런 데이터 없이

사전 생성되었다는 뜻입니다 자체 페이지를 더하지 않았고

기본 페이지는 데이터 페칭하지 않기 때문에 타당하죠

index.js 즉 / 는 getStaticProps로 정적으로 사전 생성되었습니다

그래서 여기에 ●이 있습니다

출력을 이렇게 읽을 수 있습니다 또 지금 생성되고 프로덕션 준비 코드를

.next 폴더를 보면

즉 npm run build 명령의 출력을 포함하는 .next 폴더를 보면

더 자세히 볼 수 있는 server 폴더가 있는데

거기서 사전 생성된 HTML 파일을 확인할 수 있습니다

이게 사전 생성된 HTML 파일 두 개죠 그리고 index.html을 열어보면

Product 데이터를 확인할 수 있는데

브라우저에서 이 페이지를 방문하면 보일

사전 생성된 페이지죠

그리고 검색 엔진 크롤러나 페이지의 방문자에게

초기 요청으로 다시 보내지는 사전 생성된 페이지입니다

여기에서 npm start를 실행해서 프로덕션 준비 페이지를 미리 볼 수 있습니다

npm start는 Node.js 서버로 프로덕션 준비 페이지를 시작하는데

일반적으로 페이지 프로덕션을 위해

원격 컴퓨터로 이를 수행하기도 하지만

개발자 컴퓨터로 로컬 수행할 수도 있습니다

localhost:3000에서 시작하지만

지금은 개발 서버가 아니라 프로덕션 준비 페이지를 제공하는 실제 서버입니다

그래서 브라우저로 localhost:3000에

들어가면 이 사전 렌더링된 Product를 볼 수 있습니다

이 .next 폴더의 pages 폴더에

프로덕션 준비 파일에 관한 게 있기 때문입니다

참고로 페이지 소스에는

Next.js가 삽입한 스크립트 태그가 있고

필요한 데이터를 포함합니다

이는 사전 렌더링된 HTML 코드가

React 애플리케이션과 연결되는 수화 과정에 필요합니다

그리고 프리페칭한 데이터는 그 React 애플리케이션으로 전달돼서

React 애플리케이션이 전달된 게 동적 데이터인지

어떤 종류의 데이터를 렌더링 할지 알 수 있습니다

따라서 수신한 데이터로 계속 작업하고

React.js를 통해 해당 데이터를 업데이트하면

React는 어떤 종류의 데이터가 수신되었는지 아는 거죠

이는 참고 사항일 뿐이고 모두 자동으로 수행되기 때문에

아무 작업도 할 필요가 없습니다

지금까지 Next.js가 작동하는 방식과 페이지를 사전 렌더링하는 법을 보여드렸습니다
