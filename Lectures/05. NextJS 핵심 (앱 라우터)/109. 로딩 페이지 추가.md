이제 식사를 로딩할수 있으니

한가지 눈길가는것이 있으실 것입니다

이 슬래쉬(/) 페이지를 다시 로딩하면

화면에 뭔가가 보이기까지

몇 초가 걸립니다

그럴 수도 있는 게

데이터베이스에서 식사 정보를 가져올때

지연시간을 추가했기 때문입니다

여기서 2초 딜레이(지연)을 추가했기 때문에

페이지가 업데이트 되기 전에

2초정도 멈춤이 있는것입니다

당연히 이것을 조금 더 길게 하기 위해

5초로 정하면 화면이 나오기까지

5초가 걸릴것입니다

하지만 만약 다른 페이지에 갔다가

다시 여기로 온다면

이 meals 페이지가 거의 바로 로딩됩니다

이때는 5초를 기다리지 않아도 됩니다

이게 왜그러냐면

NextJS는 안보이는곳에서 굉장히 공격적인

캐싱을 하기 때문입니다

정확히 말하면 여러분이 들어간 페이지들을 모두 캐시합니다

그 페이지의 데이터까지 말입니다

그러니 다른 페이지에 갔다가 돌아온다면

캐시에서 존재하고 있는 페이지를 로딩하여

최대한 빨리 보여지게 합니다

이 페이지를 새로고침할때만, 그러니까 본질적으로

이 페이지를 떠났다가 다시 돌아올때만

이 페이지가 다시 설계되는것입니다

좋습니다

하지만 이 페이지에 들어왔을때

로딩 표시가 있으면 더욱 좋을 것같습니다

왜냐하면 지금은 5초동안 기다리면서

아무것도 보여지지 않기 때문입니다

예를들어 시작 페이지에서

이 페이지를 새로 로딩하고 browse meals로 가면

아직 캐시에 저장정보가 없습니다

그러니 저는 여기 앉아서

제 네비게이션 요청이 제대로 들어간 건지 의아해집니다

왜냐하면 5초가 있어야

이 페이지로 들어갈 수 있기 때문입니다

그것은 유저 입장에서 아주 좋다고 할수는 없죠

이것을 개선하는 방법은

파일에 특별한 폴더를 새로 추가하는 방법입니다

데이터를 로딩하는 그 페이지로 갑니다

조금 더 걸릴수도 있지만

그 옆에 loading.js 파일을 추가할 수 있습니다

Layout 처럼 지정된 파일 이름입니다

이 옆의 page파일이나 다른 중첩된 페이지가

데이터를 불러올때 활성화 됩니다

그러면 데이터가 나올때 까지 이 loading js 요소는

대체로 보여지게 됩니다

그러니 이 loading.js 파일 안에

컴포넌트 함수를 export 하여

이름을 MealsLoadingPage 같은것으로 짓겠습니다

그 안에 p 요소를 return 시켜서

'식사를 불러오는중…' 이라고 씁니다

그리고 이것에 대한 스타일링이 있으면 좋겠습니다

그래서 loading.module.css 파일을 준비했습니다

첨부에서 찾으실수 있으며 이것은 이 loading.js 파일을 위해

기본적인 스타일링을 설정합니다

사용하기 위해서는 loading.module.css 에서

Classes를 import 합니다

그리고 loading이라는 이름의 클래스를 추가합니다

여기 p 요소에 이렇게

이제 이것을 저장하시고

페이지 새로고침을 하시면

'식사 불러오는중…' 이라고 페이지가 뜨기 전에 보입니다

그리고 시작페이지로 가서

Browse meals 로 간다면

이 문구가 바로 보입니다

그러면 네비게이션이 제대로 되었고

무슨일이 일어나는지 알 수 있습니다

이제 전보다는 더 나은 사용자 경험이라고

할 수 있겠습니다
