# 108.

## 💡 NextJS 애플리케이션에서 데이터 로딩을 하는것에 있어서 몇가지 선택권!

### 📌 바닐라 리액트 애플리케이션에서 하는 것처럼 똑같이 하는 방식

- 예를 들어 `useEffect 훅` 을 사용하여 그 안에 `fetch 함수` 를 사용해 백엔드로 요청을 넣을 수 있음
- 그리고 그 백엔드에서 설정한 데이터베이스로 가서 그곳에서 데이터를 가져올 수 있음
- NextJS 애플리케이션에서는 사실 이미 백엔드를 가지고 있음.
  **백엔드와 프론트엔드가 결합이 되었고 원활하게 혼합**되어 있음.
  그렇기에 백엔드를 분리시킬 필요가 없음.
- NextJS에서는 기본적으로 모든 컴포넌트들이 서버에서만 실행되는 **서버 컴포넌트**임
  - useEffect처럼 클라이언트 컴포넌트가 되어야 하는 기능을 사용하지 않는 한 !
  - 하지만 실제로 **서버 컴포넌트가 기본이기 때문에 useEffect을 사용하지 않아도 되고 데이터를 가지러 fetch 요청을 보내지 않아도 됨**

### 📌 서버 컴포넌트라 가능한 방식

이 컴포넌트가 기본값으로 서버에서만 실행되기 때문에 여기서 바로 데이터베이스로 갈 수 있음

- root 프로젝트 폴더 안에 새로운 폴더를 만들어 `lib` 이라고 지정, 이름은 원하는대로 정해진것은 없음
- 그 안에 새로운 파일, `meal.js` 를 추가하고 그 안에서 데이터베이스에 도달하고 그 데이터베이스에서 데이터를 가져올 수 있는 코드를 씀
- 그러면 이 안에 **Better-sqlite3 패키지** 안에서 sql을 임포트
  - 데이터베이스 연결을 하기 위하여 SQL을 함수로 만들어 데이터베이스의 이름을 string (문자열)로 이 함수에 전달
    - 그리고 DB 객체를 가져와서 이 데이터베이스에 작업하도록 함.
      그러기위하여 GetMeals라는 export function을 추가
    - 이름이 함축한대로 데이터베이스에서 모든 식사(meal)을 가져올 것
- 그리고 이 DB 객체를 사용하여 새로운 SQL문을 준비하여 실행될 수 있게 함
  ```
  export async function getMeals() {
    await new Promise((resolve) => setTimeout(resolve, 2000));
    return db.prepare("SELECT * FROM meals").all();
  }
  ```
  - Meals표에서 모든 열을 select (선택) 하려고 함
    - 이것을 실행시키면 되는데 여기선 `**run`** 방식을 사용하지 않고 `**all\*\*` 방식을 사용합니다
    - **`run`** 은 데이터를 주입시킬때, 예를 들면 데이터를 바꿀때 사용!
    - `**all**` 은 데이터를 불러올때, 그러니까 이 문장에 의해 가져오는 모든 행을 가져올 때 사용
      한가지 열만 찾고싶다면 get을 사용해도 됨
      하지만 여기선 여러개의 줄이기 때문에 all을 사용하고 여기서 결과값을 받으면 됨
- 이것은 promise나 비슷한것을 생성하지 않고 그냥 이렇게 반환 시키시면 됩니다
- Promise 얘기가 나와서 말인데 여기선 사용하지 않지 알고 이해할 가치가 있습니다 여기 better-sqlite3는 사용하지 않습니다
- 여기서는 사용하지 않지만 여기 이 컴포넌트에서는 쉽게 사용할 수 있습니다
- 왜냐하면 서버 컴포넌트 함수들이 실제로 Async 함수로 바뀔수 있기 때문입니다
- 여기에서 async 키워드를 사용할 수 있습니다

```
async function Meals() {
  const meals = await getMeals();

  return <MealsGrid meals={meals} />;
}
```

- 리액트 컴포넌트에서는 할 수 없었던 일입니다 하지만 서버 컴포넌트에서는 할 수 있고 만약 promise를 사용하는 코드가 있었다면 여기에 await을 사용할 수 있습니다
- 이것을 구현하기 위해서는 Meals.JS로 돌아가서 getMeals 함수를 async로 바꾸어줍니다 그렇게하면 promise가 리턴됩니다

그리고 여기 컴포넌트 함수에도 사용할 수 있습니다

이것은 리액트에선 하지 않지만 서버 컴포넌트에서는 할 수 있는 일입니다

그러니 여기서 getMeals를 await 해서 식사(meals) 정보를 가져옵니다 그러면 여기에 정보를 받을 수 있습니다

UseEffect를 사용하거나 불필요한 데이터 fetch 기능을 사용하지 않고서 이게 되었으니 이 meal 정보를 여기 밑쪽에 MealsGrid에 사용할 수 있습니다 간단하게 MealsGrid로 meals를 전달시키면 됩니다
