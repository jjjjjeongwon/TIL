# 127. 캐시 유효성 재확인 트리거

# NextJS가 공격적으로 캐싱을 하는 문제점을 고칠 방법?

### 📎 revalidatePath

- 새로운 음식을 등록할 때 마다 NextJS에게 캐시의 전체나 일부를 비우라고 해야 함
- 이는 흔한 요구 사항이므로 내장된 메소드가 있음
- NextJS가 제공하는 내장된 함수이며 server action에서 음식을 저장하고 리다이렉트하기 전에 사용
- 이 함수는 NextJS가 특정 path(경로)에 속하는 캐시의 유효성 재검사(revalidate)를 하게 함
  - 예를 들어 meals 페이지를 다시 방문하는데 이 페이지에는 변화하는 데이터가 포함되어 있다면 NextJs에게 `'/meals'`경로에 대하여 유효성 재검사를 함
- 중요한 것은 기본 값으로 이 path만 검사됨
  - 중첩 path는 영향을 받지 않기 때문에 만약 음식 데이터에 영향을 받는 중첩된 path가 meals 폴더 안에 있다면 각각 따로 재검사 해야 할 것
- 다행히 **revalidatePath 함수** 두 번째 인수로 layout을 전달하면 두 번째 인수의 기본 값은 page로 이 path의 이 페이지만 재검사하겠다는 뜻이 됨
- 이를 layout으로 설정하게 되면 재검사되는 것은 layout으로 중첩된 페이지를 포함하므로 중첩된 모든 페이지를 재검사하게 됨
- `revalidate(유효성 재검사)`의 의미는 간단히 말해 NextJs가 해당 페이지에 연관된 캐시를 비우는 것을 의미(캐싱된 페이지 같은 것!)

---

- 여기에서는 중첩된 페이지를 신경 쓸 필요가 없음.
  이 동적 페이지는 현재 설정에 따라 사전 생성되지 않고 share 페이지는 음식 데이터를 사용하지 않으므로 `/meals` path만 재검사하면 됨
- 만약 웹 사이트의 **모든 페이지를 재검사하고 싶다면 path로 '/'를 전달하고 모드를 layout으로 설정**하면 됨
- 여전히 사전 생성되고 캐싱되지만 이제 새로운 음식을 등록하면 캐시가 재검사되고 일부가 비워질 것임!

> 음식이 보이기 때문에 좋은 징조!
> 또한 의도한 대로 동작한다는 증거로 이제 '식사 fetching 중' 로그가 출력!
