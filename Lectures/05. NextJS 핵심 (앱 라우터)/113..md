이제는

식사 세부 페이지를 작업해봅시다

그러기 위해서 이 meals 폴더안의

다이나믹 세그먼트 폴더인

MealSlug 폴더 안 여기 페이지 폴더로 갑니다

왜냐하면 여기 이 컴포넌트가

식사 세부정보를 출력하기 때문입니다

그 다음 다시 여기에 fragment(프래그먼트)를 출력시킵니다

왜냐하면 여기에 헤더도 넣고 싶고

그 옆에는 다른 페이지에도 있었던것 처럼

메인 섹션이 있었으면 합니다

이 페이지를 위한 스타일도 준비했습니다

첨부에 page.module.css 파일을 찾으실 수 있습니다

그것을 이 page.js 파일 옆에 저장하십시오

그 다음 page.module.css 파일에서

클래스들을 가져옵니다

예를들어 여기 헤더 옆에 클래스를 추가합니다

이 헤더에, 헤더라는 이름의 클래스를 추가합니다

그리고 이 헤더 안에 몇가지 부분이 있었으면 합니다

예를들어 여기에 div를 추가하여

이미지 클래스를 넣으면 이 식사에 해당하는

사진을 불러오는것을 담당할 것입니다

그리고 이미지 출력을 하는 것은

Image 컴포넌트가 도와줄 것입니다

이것은 NextJS에서 제공되어

Next image 패키지에서 import 됩니다

이 사진들 구성은 나중에 하겠습니다

왜냐하면 지금은 아직 Meal이 없기 때문입니다

그것에 대한 로직은 곧 추가하도록 하겠습니다

지금 바로 추가하고 싶은것은 이 fill 속성입니다

아직 사진파일의 정확한

크기를 모르기 때문입니다

그러니 이 fill 속성을 대체나

솔루션으로 사용하겠습니다

그리고 그 밑에 새로운 div를 추가하여

headerText라는 클래스를 추가하겠습니다

이렇게 대시를 사용하지 않고 카멜케이스로 쓰시면 됩니다

이게 CSS 파일에 있는 CSS 클래스의 이름입니다

그 안에 이제 h1 요소를 추가하셔서

나중에 여기서 헤더 제목이 출력될 것입니다

그 밑엔 p 요소를 추가하여

또 다른 CSS 클래스, creator 을 줍니다

여기에 by 라는 텍스트와

Creator의 이름을 링크로 묶습니다

그리고 여기엔 일반 앵커를 사용하겠습니다

왜냐하면 이것은 그 creator에게

이메일을 보내는 링크가 되어야 하기 때문입니다

그러니 실제로 여기 href의 값은

동적으로 만든 string (문자열)이 됩니다

여기 백틱이 있는

문자열 리터럴 문법을 사용하고 있습니다

여기에 mail to (수신자) 라고 하고

그리고 나중에 이메일 주소를

여기에 주입시키겠습니다

이렇게하여 이메일 프로그램을

여는 링크를 셋팅하여

유저들이 그 사람에게 메일을 보낼 수 있게 합니다

이 밑에 새로운 p 태그를 추가하여

마찬가지로 클래스를 줍니다

여기의 클래스는 summary(요약) 클래스로

식사 상세를 요약하는 짧은 요약 텍스트를

출력 시키고 싶습니다

그러면 이것이 헤더입니다

물론 많은 정보가 빠져있지만

곧 처리하도록 하겠습니다

이제 메인 섹션에서

하나의 패러그래프를 아웃풋 시키서

Instruction(지침) 이라는 이름의 클래스를 주겠습니다

그 다음 여기에는 모든 식사에 저장되어있는

설명서를 아웃풋 시키고 싶습니다

그것들은 HTML 코드로 출력되어야 하며

이것은 리액트 안에서

dangerouslySetInnerHTML 속성을 한 요소에 타겟시켜 이룰 수 있습니다

이렇게 불리우는 이유는 왜냐하면 컨텐츠를 HTML로

출력시키면 크로스 사이트 스크립트(XSS) 공격에 노출되기 때문입니다

적어도 이것을 검증하지 않는다면 말입니다

이 속성은 객채를 값으로 가져야 하고

그 객채는 \_\_html 속성을 가지고 있어

실제 화면에 출력되어야 하는

HTML 코드를 가지고 있을것 입니다

그 코드는 나중에 해당 meal 에서

가져오도록 하겠습니다만

이렇게 하여 화면에 출력할 수 있는 것 입니다

그러면 마지막엔 이것이 우리가 출력 하고자 하는 데이터가 없는

식사 상세 페이지 입니다

식사 상세 화면에 출력될

몇가지 데이터를 가지기 위하여

Lib 폴더 안에 있는 meals.js 파일로 돌아갑니다

그리고 새로운 async function을 export 하여

GetMeal이라 하겠습니다

그러면 여기엔 가져와야 하는 식사 정보의 메뉴를

식별하는 slug 가 있어야 합니다

그 다음엔 간단히 db.prepare을 리턴시키고

그 다음 meals table의 모든 열을 SELECT하는데

Slugfield가

여기 위에서 나오는 slug와 동일할때만 그렇습니다

이제 이런식으로 추가할 수도 있지만

이것은 불안정 하여

SQL 인젝션에 노출될 수 있습니다

그 대신 물음표를 플레이스홀더로

사용하셔야 합니다

그리고 한가지 기록만 원하기 때문에

여기에 get 메소드를 사용합니다

그런 다음 해당 플레이스홀더에 들어가야 하는

값을 Get으로 전달합니다

이 상황에서 그것은 slug 입니다

그리고 여기 사용하는 better-sqlite3가

SQL 인젝션으로부터 지켜줄 것입니다

이것이 여러분의 구문에

동적인 값을 넣어야 하는 이유입니다

이것이 이제 meal 을 반환할 것입니다

이제 Meals Details 페이지로 돌아가서

GetMeal을 불러옵니다

그리고 그것을 lib 폴더와

Meals.js 파일에서 가져옵니다

그러면 여기서 한가지 meal이 나올것이고

그것을 여기 밑에 사용해서

이 JSX 코드를 채울 수 있습니다

하지만 getMeal은 당연히 이 slug가 필요합니다

이 slug는 단순히 url에 인코딩 된 부분이고

이 URL은 여기 플레이스더의 도움으로 포착된 것입니다

이 mealSlug 플레이스홀더입니다

그렇다면 URL의 일부인 고정된 값에

어떻게 액세스 할 수 있을까요?

이 페이지에서 받는 props가 도움을 줄 것입니다

이전에도 언급했지만 NextJS는 특별한 props을

이 특별한 폴더에 전달합니다

아니면 이 특별한 폴더에 있는 컴포넌트들에게요

예를들어 page.js 파일에 저장된

모든 컴포넌트들은

특별한 params prop을 받을 것입니다

그것은 여러분이 구조 분해 할당 할 수 있습니다

그러면 이 params 속성에는 이 경로에 대해

구성된 동적인 경로 세그먼트가

키-값 쌍으로 저장되는 값으로

객체가 포함됩니다

그리고 여기 대괄호안에

설정한 이름이 Key(키)의 역할을 할 것입니다

그리고 실제로 URL에 인코딩된 값이

그 키의 값이 될것입니다

그리고 데이터베이스에서 해당 값을 찾기 위해

필요 한 값입니다

그러니 이제 params.mealsSlug를 getMeal로 전달시키고

이는 데이터베이스에서 meal을

가져올 수 있게 해주는 identifier (식별자)가 될 것입니다

이제 이게 작동되는지 보기 위해

Meal.title을 사용하여 제목 출력을 시도해봅시다

이렇게 하여 모든것을 저장하면

여기 아무것도 없습니다

이러는 이유는 async 키워드를

사용하기때문에 getMeal이 promise를 반환하기 때문입니다

그리고 이것이 추가된 이유는 우리가 원할때

추가 지연을 넣거나

특정 로딩 페이지가 있길 원하거나 아니면

로딩을 다른 방식으로 해결할때를 위해서 였습니다

이제 여기선 이렇게 하지 않을것이니

단순히 이 async 키워드를 없애도 됩니다

그러면 getMeal은 이제 promise를 반환하지 않습니다

이제 코드가 작동 될 것입니다

이제 화면으로 돌아가면 여기에

데이터베이스에서 불려온 제목이 보입니다

그리고 그것은 이제 다른 데이터도

모두 출력시킬수 있다는것을 의미합니다

예를들어 image 에서

src 속성을 meals.image로 설정할 수 있습니다

왜냐면 데이터베이스에 그런 이미지 키가 있을것이고

지금 그 데이터를 가져올 것이니까요

alt.text는 meal.title로 지정할 수 있습니다

여기 이메일 주소는

Meal.creator_email을 사용하겠습니다

데이터베이스에서 사용하는 이름입니다

이 initdb.js file을 보면

이 이름들을 볼 수 있습니다

여기에 필드 이름들이 있고

이것들을 여기 Meals Details 페이지에서

사용하는것입니다

그리고 이름은 meals.creator을 사용하여 출력될 수 있습니다

그리고 요약에는 meals.summary를 쓰겠습니다

그리고 밑에 있는 HTML 코드는 meals.instructions인데

이 중괄호는 빼겠습니다

모든것을 다 했으니 이제 돌아가서 로딩을 하면

이런 페이지를 보게 됩니다

그리고 여기 밑에 있는 컨텐츠가

완벽하지는 않습니다

왜냐하면 여기 instructions의

줄바꿈이 무시되었기 때문입니다

이것은 meals.instructions를

meal.instructions.replace로 덮어써서

이 string(문자열)의 부분을 바꾸시면 됩니다

그리고 여기에서 정규식을 사용하여

이 특수문자로 식별되는 모든 줄바꿈을

찾을 수 있습니다

이 문자열 에 있는 모든것을 찾아서

br 태그, 줄바꿈 태그로

바꾸어줍니다

이렇게 하면 이제 줄바꿈이 돌아온것을 확인 가능합니다

이렇게 하여 식사 정보를

로딩하고 디스플레이 하는 것입니다
